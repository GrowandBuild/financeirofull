const DOMCache={searchInput: null,productGrid: null,init(){this.searchInput=document.querySelector('.premium-search-input');this.productGrid=document.querySelector('.premium-product-grid');}};const PerformanceMonitor={startTime: 0,start(){this.startTime=performance.now();},end(label='Operation'){const duration=performance.now()-this.startTime;console.log(`${label}took ${duration.toFixed(2)}ms`);return duration;}};const SearchManager={debounceTimer: null,cache: new Map(),init(){if(DOMCache.searchInput){DOMCache.searchInput.addEventListener('input',(e)=>{this.handleSearch(e.target.value);});}},handleSearch(query){clearTimeout(this.debounceTimer);if(query.length < 2){this.clearResults();return;}this.debounceTimer=setTimeout(()=>{this.performSearch(query);},300);},async performSearch(query){PerformanceMonitor.start();if(this.cache.has(query)){this.displayResults(this.cache.get(query));PerformanceMonitor.end('Search(cached)');return;}try{const response=await fetch(`/products/search?q=${encodeURIComponent(query)}&ajax=1`);const data=await response.json();this.cache.set(query,data);this.displayResults(data);PerformanceMonitor.end('Search(API)');}catch(error){console.error('Erro na busca:',error);}},displayResults(data){console.log('Resultados da busca:',data);},clearResults(){}};const LazyImageLoader={observer: null,defaultImage: '/images/no-image.png',init(){if('IntersectionObserver' in window){this.observer=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting){this.loadImage(entry.target);}});},{rootMargin: '50px 0px',threshold: 0.1});this.observeImages();}},observeImages(){const images=document.querySelectorAll('img[data-src]');images.forEach(img=>{if(!img.hasAttribute('data-error-handled')){img.setAttribute('data-error-handled','true');img.addEventListener('error',function(){const defaultImg=this.getAttribute('data-default')|| this.closest('.lazy-image-container')?.querySelector('img[data-src]')?.getAttribute('data-default')|| LazyImageLoader.defaultImage;if(this.src !==defaultImg && !this.src.includes('no-image')){this.src=defaultImg;}},{once: true});}this.observer.observe(img);});},loadImage(img){if(!img.dataset.src){return;}if(img.src && img.src !==this.defaultImage && img.src !==img.dataset.src){this.observer.unobserve(img);return;}img.src=img.dataset.src;img.classList.remove('lazy');this.observer.unobserve(img);}};const CacheManager={storage: localStorage,prefix: 'meus_produtos_',set(key,value,ttl=300000){const item={value,timestamp: Date.now(),ttl};this.storage.setItem(this.prefix+key,JSON.stringify(item));},get(key){const item=this.storage.getItem(this.prefix+key);if(!item)return null;const parsed=JSON.parse(item);const now=Date.now();if(now-parsed.timestamp > parsed.ttl){this.storage.removeItem(this.prefix+key);return null;}return parsed.value;},clear(){const keys=Object.keys(this.storage);keys.forEach(key=>{if(key.startsWith(this.prefix)){this.storage.removeItem(key);}});}};const AnimationManager={animateIn(element,animation='fadeIn'){element.style.opacity='0';element.style.transform='translateY(20px)';requestAnimationFrame(()=>{element.style.transition='all 0.3s ease';element.style.opacity='1';element.style.transform='translateY(0)';});},staggerIn(elements,delay=100){elements.forEach((element,index)=>{setTimeout(()=>{this.animateIn(element);},index*delay);});}};const ErrorHandler={init(){window.addEventListener('error',(event)=>{if(event.target &&(event.target.tagName==='IMG' || event.target.tagName==='LINK')){return;}if(event.error){console.error('Erro JavaScript:',event.error);this.reportError(event.error);}});window.addEventListener('unhandledrejection',(event)=>{if(event.reason && typeof event.reason==='string' && event.reason.includes('404')){return;}console.error('Promise rejeitada:',event.reason);this.reportError(event.reason);});},reportError(error){if(window.location.hostname !=='localhost' && window.location.hostname !=='127.0.0.1'){console.log('Erro reportado:',error);}}};const PerformanceOptimizer={prefetchedPages: new Set(),init(){this.preloadCriticalResources();this.optimizeImages();this.optimizePageTransitions();},preloadCriticalResources(){return;},optimizeImages(){if(this.supportsWebP()){const images=document.querySelectorAll('img[src]:not([src=""]):not([src*="no-image"])');images.forEach(img=>{if(img.hasAttribute('data-src')){return;}if(img.src.includes('no-image')|| img.src.includes('placeholder')){return;}if(img.src.includes('.webp')){return;}const hasValidExtension=/\.(jpg|jpeg|png)$/i.test(img.src);if(!hasValidExtension){return;}const webpSrc=img.src.replace(/\.(jpg|jpeg|png)$/i,'.webp');const webpImg=new Image();webpImg.onload=()=>{if(webpImg.complete && webpImg.naturalWidth > 0){img.src=webpSrc;}};webpImg.onerror=()=>{};webpImg.src=webpSrc;});}},supportsWebP(){const canvas=document.createElement('canvas');canvas.width=1;canvas.height=1;return canvas.toDataURL('image/webp').indexOf('data:image/webp')===0;},setupPrefetching(){const prefetchLinks=[ '/products/search','/products/compra' ];prefetchLinks.forEach(link=>{const prefetchLink=document.createElement('link');prefetchLink.rel='prefetch';prefetchLink.href=link;document.head.appendChild(prefetchLink);});},setupPagePrefetching(){return;},prefetchPage(url){if(this.prefetchedPages.has(url))return;const prefetchLink=document.createElement('link');prefetchLink.rel='prefetch';prefetchLink.href=url;prefetchLink.onload=()=>{this.prefetchedPages.add(url);console.log('PÃ¡gina prefetchada:',url);};document.head.appendChild(prefetchLink);},optimizePageTransitions(){this.setupLoadingStates();},setupLoadingStates(){return;},setupPageTransition(){return;},async navigateToPage(url){window.location.href=url;},async getFromCache(url){return null;},async cachePage(url,response){return;},updatePageContent(html){const parser=new DOMParser();const doc=parser.parseFromString(html,'text/html');const newContent=doc.querySelector('.premium-content')|| doc.querySelector('.mobile-container');const currentContent=document.querySelector('.premium-content')|| document.querySelector('.mobile-container');if(newContent && currentContent){currentContent.innerHTML=newContent.innerHTML;}this.reinitializeComponents();},reinitializeComponents(){if(window.MeusProdutos && window.MeusProdutos.App){window.MeusProdutos.App.animatePageElements();}},showPageLoading(){if(!document.getElementById('page-loading')){const loading=document.createElement('div');loading.id='page-loading';loading.innerHTML=` <div style=" position: fixed;top: 0;left: 0;right: 0;height: 3px;background: linear-gradient(90deg,#10b981,#059669);z-index: 9999;animation: loading 1s ease-in-out infinite;"></div> <style> @keyframes loading{0%{transform: translateX(-100%);}100%{transform: translateX(100%);}}</style> `;document.body.appendChild(loading);}},hidePageLoading(){const loading=document.getElementById('page-loading');if(loading){loading.remove();}}};const App={init(){PerformanceMonitor.start();DOMCache.init();SearchManager.init();LazyImageLoader.init();ErrorHandler.init();PerformanceOptimizer.init();HamburgerMenuManager.init();this.animatePageElements();PerformanceMonitor.end('App Initialization');},animatePageElements(){const cards=document.querySelectorAll('.premium-product-card,.top-product-card');if(cards.length > 0){AnimationManager.staggerIn(Array.from(cards),50);}}};function forceReloadCSS(){const cssLink=document.getElementById('main-css')|| document.querySelector('link[href*="app.css"]');if(cssLink){setTimeout(()=>{const hamburger=document.getElementById('hamburgerMenu');const menuPanel=document.querySelector('.hamburger-menu-panel');if(hamburger && menuPanel){const hamburgerStyle=window.getComputedStyle(hamburger);const panelStyle=window.getComputedStyle(menuPanel);const shouldBeHidden=!menuPanel.classList.contains('active');const isHidden=panelStyle.visibility==='hidden' || panelStyle.left==='-100%' || panelStyle.left.includes('-100%');if((shouldBeHidden && !isHidden)||(!shouldBeHidden && isHidden)){console.warn('CSS pode estar desatualizado,forÃ§ando recarregamento...');const href=cssLink.href.split('?')[0];const timestamp=new Date().getTime();cssLink.href=`${href}?v=${timestamp}`;}}},1500);}}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{App.init();forceReloadCSS();});}else{App.init();forceReloadCSS();}async function clearAllCachesSimple(){if(typeof window.confirmAction==='function'){const confirmed=await window.confirmAction('Tem certeza que deseja limpar todos os caches?','Limpar Caches');if(confirmed){try{localStorage.clear();if('caches' in window){caches.keys().then(names=>{names.forEach(name=> caches.delete(name));});}sessionStorage.clear();if(typeof window.showSuccess==='function'){window.showSuccess('Todos os caches foram limpos com sucesso!');}window.location.reload();}catch(error){console.error('Erro ao limpar caches:',error);if(typeof window.showError==='function'){window.showError('Erro ao limpar caches. Por favor,tente novamente.');}}}}}let devMode=false;function toggleDevModeSimple(){devMode=!devMode;const btn=document.getElementById('simpleDevBtn');if(devMode){btn.classList.add('active');btn.style.background='rgba(245,158,11,0.8)';console.log('%cðŸ”§ MODO DEV ATIVADO','font-weight: bold;font-size: 16px;color: #f59e0b;');console.log('Cache Manager:',window.MeusProdutos?.CacheManager);console.log('Performance Monitor:',window.MeusProdutos?.PerformanceMonitor);}else{btn.classList.remove('active');btn.style.background='';console.log('%câœ… MODO DEV DESATIVADO','font-weight: bold;font-size: 16px;color: #10b981;');}}const HamburgerMenuManager={isOpen: false,init(){document.addEventListener('keydown',(e)=>{if(e.key==='Escape' && this.isOpen){this.close();}});const menuItems=document.querySelectorAll('.hamburger-menu-item');menuItems.forEach(item=>{item.addEventListener('click',()=>{setTimeout(()=> this.close(),200);});});},toggle(){if(this.isOpen){this.close();}else{this.open();}},open(){const menu=document.getElementById('hamburgerMenu');const panel=document.getElementById('hamburgerMenuPanel');const overlay=document.getElementById('hamburgerOverlay');if(menu && panel && overlay){menu.classList.add('active');panel.classList.add('active');overlay.classList.add('active');document.body.style.overflow='hidden';this.isOpen=true;}},close(){const menu=document.getElementById('hamburgerMenu');const panel=document.getElementById('hamburgerMenuPanel');const overlay=document.getElementById('hamburgerOverlay');if(menu && panel && overlay){menu.classList.remove('active');panel.classList.remove('active');overlay.classList.remove('active');document.body.style.overflow='';this.isOpen=false;}}};function toggleHamburgerMenu(){HamburgerMenuManager.toggle();}window.MeusProdutos={App,CacheManager,PerformanceMonitor,SearchManager,HamburgerMenuManager,clearAllCachesSimple,toggleDevModeSimple,toggleHamburgerMenu,FinanceQuotesManager: null};if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{HamburgerMenuManager.init();ensureHamburgerMenuVisible();});}else{HamburgerMenuManager.init();ensureHamburgerMenuVisible();}function ensureHamburgerMenuVisible(){const hamburgerMenu=document.getElementById('hamburgerMenu');if(!hamburgerMenu)return;const hamburgerLines=hamburgerMenu.querySelectorAll('.hamburger-line');const fallbackIcon=hamburgerMenu.querySelector('.hamburger-fallback');let hasVisibleLines=false;hamburgerLines.forEach(line=>{const style=window.getComputedStyle(line);if(style.display !=='none' && style.visibility !=='hidden' && style.opacity !=='0'){hasVisibleLines=true;line.style.display='block';line.style.visibility='visible';line.style.opacity='1';line.style.background='white';}});if(!hasVisibleLines && fallbackIcon){fallbackIcon.style.display='block';}else if(fallbackIcon){fallbackIcon.style.display='none';}}setTimeout(ensureHamburgerMenuVisible,100);const FinanceQuotesManager={quotes: [ 'Pague-se primeiro: guarde pelo menos 10% da sua renda','NÃ£o gaste mais do que vocÃª ganha','Planeje cada compra antes de executÃ¡-la','Tenha uma reserva de emergÃªncia','Invista em conhecimento,Ã© o melhor ativo','Evite dÃ­vidas desnecessÃ¡rias','Controle seus gastos diariamente','EstabeleÃ§a metas financeiras claras','Compare preÃ§os antes de comprar','Priorize necessidades sobre desejos','Registre todas as suas transaÃ§Ãµes','Revise seus gastos mensalmente','Aprenda a dizer nÃ£o a compras impulsivas','Construa mÃºltiplas fontes de renda','Pense a longo prazo,mas comece pequeno' ],currentIndex: 0,interval: null,init(){const quoteText=document.getElementById('financeQuoteText');const quoteContainer=document.getElementById('financeQuoteContainer');if(quoteText && quoteContainer){this.currentIndex=Math.floor(Math.random()*this.quotes.length);this.updateQuoteText();this.interval=setInterval(()=> this.rotateQuote(),8000);}},updateQuoteText(){const quoteText=document.getElementById('financeQuoteText');const quoteContainer=document.getElementById('financeQuoteContainer');if(!quoteText || !quoteContainer)return;quoteText.textContent=this.quotes[this.currentIndex];setTimeout(()=>{const wrapper=quoteText.parentElement;const containerWidth=wrapper.offsetWidth;quoteText.style.display='-webkit-box';const textHeight=quoteText.scrollHeight;const containerHeight=wrapper.offsetHeight;if(textHeight > containerHeight*2.5){quoteText.style.display='inline-block';const textWidth=quoteText.scrollWidth;if(textWidth > containerWidth){wrapper.classList.add('scroll-mode');const scrollAmount=textWidth-containerWidth+20;quoteText.style.setProperty('--scroll-amount',`-${scrollAmount}px`);}else{wrapper.classList.remove('scroll-mode');}}else{quoteText.style.display='-webkit-box';wrapper.classList.remove('scroll-mode');}},200);},rotateQuote(){const quoteText=document.getElementById('financeQuoteText');const quoteContainer=document.getElementById('financeQuoteContainer');if(!quoteText || !quoteContainer)return;const wrapper=quoteText.parentElement;wrapper.classList.remove('scroll-mode');quoteContainer.style.opacity='0';quoteContainer.style.transform='translateX(-10px)';setTimeout(()=>{this.currentIndex=(this.currentIndex+1)% this.quotes.length;this.updateQuoteText();quoteContainer.style.opacity='1';quoteContainer.style.transform='translateX(0)';},300);},destroy(){if(this.interval){clearInterval(this.interval);this.interval=null;}}};if(window.MeusProdutos){window.MeusProdutos.FinanceQuotesManager=FinanceQuotesManager;}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',()=>{FinanceQuotesManager.init();});}else{FinanceQuotesManager.init();}